#!/bin/sh

if pgrep qutebrowser >/dev/null 2>&1
then
    search_term="$(rofi -dmenu -p "Search term")"
    cd "${XDG_CACHE_HOME:-${HOME}/.cache}" && exec qutebrowser "${search_term:?}"
else
    session_dir="${HOME:?}/.local/share/qutebrowser/sessions"
    [ ! -d "${session_dir:?}" ] && { echo "cant find sessions directory" >&2 ; exit 1 ; }

    session="$(find -L "${session_dir}" -maxdepth 1 -type f -name '*.yml' -exec basename \{\} .yml \; | \
                  rofi -dmenu -p "Choose session" )"
    cd "${XDG_CACHE_HOME:-${HOME}/.cache}" && exec qutebrowser --restore "${session:?}" "$(rofi -dmenu -p "Search term")"
fi
